---
name: 更新 OWL 模板添加新樣式類別
status: closed
created: 2026-01-08T17:23:27Z
updated: 2026-01-09T05:49:44Z
github: https://github.com/WOOWTECH/odoo-addons/issues/18
depends_on: [13, 14, 15, 16]
parallel: false
conflicts_with: []
---

# Task: 更新 OWL 模板添加新樣式類別

## Description

更新所有 Portal OWL 元件的 XML 模板，添加新設計的 CSS 類別，使 SCSS 樣式能夠正確套用到元件上。

## Acceptance Criteria

- [ ] `portal_entity_controller.xml` 添加新類別
- [ ] `portal_entity_info.xml` 添加新類別
- [ ] `portal_group_info.xml` 添加新類別
- [ ] `portal_templates.xml` 添加主題容器類別
- [ ] 所有新類別與 SCSS 樣式對應
- [ ] 現有功能不受影響

## Technical Details

### 1. portal_entity_controller.xml 更新

```xml
<!-- Switch Controller -->
<t t-name="odoo_ha_addon.PortalEntityController.Switch">
    <!-- 添加 .portal-iot-toggle 容器 -->
    <div class="switch-controller portal-iot-toggle d-flex align-items-center gap-3 p-3 bg-light rounded">
        <button
            class="btn btn-lg toggle-button"
            t-att-class="{
                'btn-success is-on': isOn,
                'btn-secondary is-off': isOff,
                'is-loading': isLoading
            }"
            ...
        >
            <i t-if="isLoading" class="fa fa-spinner portal-spin toggle-icon"/>
            <i t-elif="isOn" class="fa fa-toggle-on toggle-icon"/>
            <i t-else="" class="fa fa-toggle-off toggle-icon"/>
            ...
        </button>

        <span class="toggle-state-badge" t-att-class="{'is-on': isOn, 'is-off': isOff}">
            <t t-esc="entity.entity_state"/>
        </span>
    </div>
</t>

<!-- Light Controller -->
<t t-name="odoo_ha_addon.PortalEntityController.Light">
    <div class="light-controller portal-iot-toggle p-3 bg-light rounded">
        ...
        <!-- Brightness slider 添加 .portal-value-slider -->
        <t t-if="isOn and attributes.brightness !== undefined">
            <div class="brightness-control portal-value-slider portal-brightness-slider mt-3">
                <label class="slider-label">
                    <span>
                        <i class="fa fa-sun-o slider-icon"/>亮度
                    </span>
                    <span class="slider-value-badge">
                        <t t-esc="Math.round((currentBrightness / 255) * 100)"/>%
                    </span>
                </label>
                <input type="range" ... />
            </div>
        </t>
    </div>
</t>

<!-- Sensor Controller -->
<t t-name="odoo_ha_addon.PortalEntityController.Sensor">
    <div class="sensor-controller portal-sensor-display p-3 bg-light rounded">
        <div class="sensor-value-block">
            <i class="fa fa-tachometer sensor-icon" t-att-class="attributes.device_class"/>
            <span class="sensor-value"><t t-esc="entity.entity_state"/></span>
            <t t-if="attributes.unit_of_measurement">
                <span class="sensor-unit">
                    <t t-esc="attributes.unit_of_measurement"/>
                </span>
            </t>
        </div>

        <t t-if="attributes.device_class">
            <span class="sensor-device-class">
                <t t-esc="attributes.device_class"/>
            </span>
        </t>

        <div class="sensor-readonly-notice">
            <i class="fa fa-info-circle"/>
            此為感測器，僅供讀取
        </div>
    </div>
</t>
```

### 2. portal_entity_info.xml 更新

```xml
<!-- Entity Information Card -->
<t t-name="odoo_ha_addon.PortalEntityInfo.InfoCard">
    <div class="card shadow-sm mb-4 portal-entity-card portal-fade-in">
        <div class="card-header card-header-section bg-primary text-white">
            <h4 class="entity-name mb-0">
                <i class="fa fa-info-circle entity-icon"/>
                <t t-esc="entityName"/>
            </h4>
            <span
                class="badge badge-light toggle-state-badge"
                t-att-class="{'portal-state-changed': state.stateChanged}"
            >
                <t t-esc="state.entityState"/>
            </span>
        </div>
        ...
    </div>
</t>
```

### 3. portal_group_info.xml 更新

```xml
<!-- Entities Card Grid -->
<t t-name="odoo_ha_addon.PortalGroupInfo.EntitiesTable">
    <div class="card shadow-sm mb-4">
        ...
        <div class="card-body">
            <t t-if="hasEntities">
                <!-- 網格容器已有 .portal-entity-grid -->
                <div class="portal-entity-grid">
                    <t t-foreach="state.entities" t-as="entity" t-key="entity.id">
                        <!-- 卡片已有 .portal-entity-card，添加動畫類別 -->
                        <div class="portal-entity-card portal-fade-in"
                             t-att-class="{'portal-state-changed': entity.stateChanged}">
                            <!-- 添加圖示到 header -->
                            <div class="card-header-section">
                                <h6 class="entity-name">
                                    <i class="fa entity-icon" t-att-class="getDomainIcon(entity.domain)"/>
                                    <t t-esc="entity.name or '未命名'"/>
                                </h6>
                                ...
                            </div>
                            ...
                        </div>
                    </t>
                </div>
            </t>
        </div>
    </div>
</t>
```

### 4. portal_templates.xml 更新

```xml
<!-- Entity Portal Page -->
<template id="portal_entity" name="Portal Entity View">
    <t t-call="portal.portal_layout">
        ...
        <!-- 添加 .portal-page 主題容器 -->
        <div id="wrap" class="o_portal_wrap portal-page">
            ...
        </div>
    </t>
</template>

<!-- Entity Group Portal Page -->
<template id="portal_entity_group" name="Portal Entity Group View">
    <t t-call="portal.portal_layout">
        ...
        <!-- 添加 .portal-page 主題容器 -->
        <div id="wrap" class="o_portal_wrap portal-page">
            ...
        </div>
    </t>
</template>
```

### 需要添加的類別對照表

| 元件 | 新增類別 | 說明 |
|------|----------|------|
| 容器 | `.portal-page` | 主題背景和文字色 |
| 卡片 | `.portal-entity-card` | 已有，確認套用 |
| 網格 | `.portal-entity-grid` | 已有，確認套用 |
| Toggle | `.portal-iot-toggle` | Toggle 容器 |
| Toggle 按鈕 | `.toggle-button`, `.is-on`, `.is-off`, `.is-loading` | 狀態類別 |
| 滑桿 | `.portal-value-slider`, `.portal-brightness-slider` | 滑桿容器 |
| 感測器 | `.portal-sensor-display` | 感測器容器 |
| 動畫 | `.portal-fade-in`, `.portal-state-changed`, `.portal-spin` | 動畫類別 |

## Dependencies

- [ ] Task 002: 卡片樣式完成
- [ ] Task 003: Toggle 樣式完成
- [ ] Task 004: Slider 樣式完成
- [ ] Task 005: Sensor 樣式完成

## Effort Estimate

- Size: S
- Hours: 1.5
- Parallel: false（需要等 SCSS 樣式完成）

## Definition of Done

- [ ] 所有 XML 模板更新完成
- [ ] 新類別與 SCSS 樣式對應
- [ ] 無 XML 語法錯誤
- [ ] 現有功能正常運作
- [ ] 視覺效果正確呈現
