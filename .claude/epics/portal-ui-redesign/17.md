---
name: 添加狀態變化動畫效果
status: closed
created: 2026-01-08T17:23:27Z
updated: 2026-01-09T02:01:48Z
github: https://github.com/WOOWTECH/odoo-addons/issues/17
depends_on: [12, 13, 14]
parallel: false
conflicts_with: []
---

# Task: 添加狀態變化動畫效果

## Description

實作設備狀態變化時的視覺動畫效果，包括狀態切換脈動、載入指示器、以及尊重使用者的 `prefers-reduced-motion` 設定。

## Acceptance Criteria

- [ ] 狀態變化時有脈動（pulse）高亮效果
- [ ] Toggle 切換有平滑過渡
- [ ] Loading 狀態有旋轉/脈動動畫
- [ ] 尊重 `prefers-reduced-motion` 設定
- [ ] 動畫使用 GPU 加速屬性（transform/opacity）
- [ ] 深色模式動畫效果正確

## Technical Details

### 實作位置
`static/src/scss/portal.scss` - 新增 Animations 區塊

### 樣式規格

```scss
// ========================================
// Animations & Transitions
// ========================================

// 狀態變化脈動效果
@keyframes portal-state-pulse {
  0% {
    box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.5);
  }
  70% {
    box-shadow: 0 0 0 12px rgba(16, 185, 129, 0);
  }
  100% {
    box-shadow: 0 0 0 0 rgba(16, 185, 129, 0);
  }
}

// 高亮閃爍效果（已有，升級版）
@keyframes portal-highlight {
  0% {
    background-color: rgba(251, 191, 36, 0.3); // 黃色高亮
    transform: scale(1.02);
  }
  100% {
    background-color: transparent;
    transform: scale(1);
  }
}

// 脈動效果（Loading）
@keyframes portal-pulse {
  0%, 100% {
    opacity: 1;
  }
  50% {
    opacity: 0.5;
  }
}

// 旋轉效果（Loading Spinner）
@keyframes portal-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

// 數值跳動效果
@keyframes portal-value-bounce {
  0%, 100% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.1);
  }
}

// 淡入效果
@keyframes portal-fade-in {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

// ========================================
// Animation Utility Classes
// ========================================

// 狀態變化類別（由 OWL 元件添加/移除）
.portal-state-changed {
  animation: portal-highlight 1s ease-out;
}

.portal-state-pulse {
  animation: portal-state-pulse 1.5s ease-out;
}

// Loading 狀態
.portal-loading {
  position: relative;
  pointer-events: none;

  &::after {
    content: '';
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.1);
    border-radius: inherit;
    animation: portal-pulse 1.5s infinite;
  }
}

.portal-spin {
  animation: portal-spin 1s linear infinite;
}

// 淡入效果（頁面載入）
.portal-fade-in {
  animation: portal-fade-in 0.3s ease-out;
}

// ========================================
// Reduced Motion Support
// ========================================

@media (prefers-reduced-motion: reduce) {
  // 禁用所有動畫
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }

  // 保留必要的視覺變化（無動畫版本）
  .portal-state-changed {
    outline: 2px solid var(--portal-accent-warning);
    outline-offset: 2px;
  }

  .portal-loading::after {
    animation: none;
    background: rgba(0, 0, 0, 0.15);
  }

  .portal-spin {
    animation: none;
  }
}

// ========================================
// Transition Utilities
// ========================================

.portal-transition-all {
  transition: all var(--portal-transition-normal) ease;
}

.portal-transition-colors {
  transition:
    color var(--portal-transition-normal) ease,
    background-color var(--portal-transition-normal) ease,
    border-color var(--portal-transition-normal) ease;
}

.portal-transition-transform {
  transition: transform var(--portal-transition-fast) ease;
}

.portal-transition-opacity {
  transition: opacity var(--portal-transition-normal) ease;
}
```

### 效能考量

1. **GPU 加速**：所有動畫僅使用 `transform`、`opacity` 和 `box-shadow`
2. **避免重排**：不使用 `width`、`height`、`top`、`left` 動畫
3. **合理時長**：動畫時長控制在 150-1500ms 之間

### 整合點

OWL 元件中的 `stateChanged` 狀態需要對應添加 `.portal-state-changed` 類別：
- `portal_entity_info.js` - 狀態更新時
- `portal_group_info.js` - 個別 entity 狀態更新時
- `portal_entity_controller.js` - 控制操作後

## Dependencies

- [ ] Task 001: CSS 變數定義
- [ ] Task 002: 卡片樣式（動畫應用於卡片）
- [ ] Task 003: Toggle 樣式（動畫應用於 Toggle）

## Effort Estimate

- Size: S
- Hours: 1
- Parallel: false（需要先完成基礎樣式）

## Definition of Done

- [ ] 所有動畫 keyframes 定義完成
- [ ] Utility classes 可正常使用
- [ ] `prefers-reduced-motion` 支援正確
- [ ] 動畫效能良好（無卡頓）
- [ ] 深色模式動畫視覺正確
