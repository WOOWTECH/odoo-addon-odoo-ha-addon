---
name: Share Button UI - Form View Integration
status: closed
created: 2026-01-02T15:59:50Z
updated: 2026-01-02T16:55:21Z
github: https://github.com/WOOWTECH/odoo-addons/issues/6
depends_on: [3]
parallel: true
conflicts_with: [5]
---

# Task: Share Button UI - Form View Integration

## Description

在 Entity 和 Entity Group 的 Form View 中新增 "Share" 按鈕，整合標準 Odoo `portal.share` Wizard。

## Acceptance Criteria

- [ ] Entity Form View Header 新增 "Share" 按鈕
- [ ] Entity Group Form View Header 新增 "Share" 按鈕
- [ ] 按鈕僅對 `group_ha_manager` 群組可見
- [ ] 點擊按鈕開啟標準 `portal.share` Wizard
- [ ] Wizard 可正確產生分享連結
- [ ] Wizard 可發送 Email 邀請
- [ ] 在 Model 中實作 `action_share()` 方法

## Technical Details

### Model 方法
```python
# models/ha_entity.py
def action_share(self):
    self.ensure_one()
    self._portal_ensure_token()
    return {
        'type': 'ir.actions.act_window',
        'name': 'Share Entity',
        'res_model': 'portal.share',
        'view_mode': 'form',
        'target': 'new',
        'context': {
            'default_res_model': self._name,
            'default_res_id': self.id,
        },
    }
```

### XML View 變更
```xml
<!-- views/ha_entity_views.xml -->
<record id="ha_entity_form_view" model="ir.ui.view">
    <!-- 在 header 中新增 Share 按鈕 -->
    <xpath expr="//header" position="inside">
        <button name="action_share" type="object" string="Share"
                class="btn-secondary"
                groups="odoo_ha_addon.group_ha_manager"/>
    </xpath>
</record>

<!-- views/ha_entity_group_views.xml - 同樣結構 -->
```

### 檔案影響
- `models/ha_entity.py` (修改 - 新增方法)
- `models/ha_entity_group.py` (修改 - 新增方法)
- `views/ha_entity_views.xml` (修改 - 新增按鈕)
- `views/ha_entity_group_views.xml` (修改 - 新增按鈕)

### 權限考量
1. 按鈕使用 `groups="odoo_ha_addon.group_ha_manager"` 限制
2. 只有 HA Manager 可以分享
3. HA User 看不到此按鈕

## Dependencies

- [ ] Task 001: Model Layer 必須先完成（提供 portal.mixin）

## Effort Estimate

- Size: S
- Hours: 4
- Parallel: true (可與 Task 003 平行，但可能有衝突)

## Definition of Done

- [ ] Code implemented
- [ ] HA Manager 可看到 Share 按鈕
- [ ] HA User 看不到 Share 按鈕
- [ ] portal.share Wizard 正確開啟
- [ ] 分享連結可正確產生
- [ ] Code reviewed
