---
name: Portal Templates - QWeb Views
status: closed
created: 2026-01-02T15:59:50Z
updated: 2026-01-02T16:55:11Z
github: https://github.com/WOOWTECH/odoo-addons/issues/5
depends_on: [4]
parallel: false
conflicts_with: []
---

# Task: Portal Templates - QWeb Views

## Description

建立 Portal QWeb Templates (`views/portal_templates.xml`)，包含 Entity 頁面、Entity Group 頁面、403 錯誤頁面，以及 Polling JavaScript。

## Acceptance Criteria

- [ ] 建立 `views/portal_templates.xml` 新檔案
- [ ] 在 `__manifest__.py` 的 `data` 中註冊新檔案
- [ ] Entity Portal 頁面繼承 `portal.portal_layout`
- [ ] Entity Group Portal 頁面顯示 Group 資訊和 Entities 列表
- [ ] 包含 Breadcrumbs 導航
- [ ] 包含 Chatter 區塊（使用 `mail.message_thread`）
- [ ] 403 錯誤頁面友善顯示
- [ ] 響應式設計（Mobile-friendly）
- [ ] 內嵌 Polling JavaScript (5 秒更新)

## Technical Details

### Template 結構
```xml
<!-- views/portal_templates.xml -->
<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <!-- 403 Error Page -->
    <template id="portal_error_403" name="Portal Access Denied">
        <t t-call="portal.portal_layout">
            <div class="alert alert-danger text-center">
                <h2>Access Denied</h2>
                <p>The link is invalid or has expired.</p>
            </div>
        </t>
    </template>

    <!-- Entity Portal Page -->
    <template id="portal_entity" name="Portal Entity View">
        <t t-call="portal.portal_layout">
            <!-- Breadcrumbs -->
            <t t-set="o_portal_fullwidth_alert" groups=""/>
            <div id="wrap">
                <div class="container">
                    <!-- Breadcrumbs -->
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item">Entity</li>
                        <li class="breadcrumb-item active" t-out="entity.name"/>
                    </ol>

                    <!-- Entity Card -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h3 t-out="entity.name"/>
                        </div>
                        <div class="card-body">
                            <dl class="row">
                                <dt class="col-sm-3">State</dt>
                                <dd class="col-sm-9" id="entity-state" t-out="entity.entity_state"/>
                                <dt class="col-sm-3">Last Changed</dt>
                                <dd class="col-sm-9" t-out="entity.last_changed"/>
                                <dt class="col-sm-3">Area</dt>
                                <dd class="col-sm-9" t-out="entity.area_id.name or 'N/A'"/>
                            </dl>
                        </div>
                    </div>

                    <!-- Chatter -->
                    <div t-call="portal.message_thread">
                        <t t-set="object" t-value="entity"/>
                    </div>
                </div>
            </div>

            <!-- Polling JavaScript -->
            <script type="text/javascript">
                const entityId = <t t-out="entity.id"/>;
                const accessToken = '<t t-out="access_token"/>';
                setInterval(() => {
                    fetch(`/portal/entity/${entityId}/state`, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({jsonrpc: '2.0', params: {access_token: accessToken}})
                    })
                    .then(res => res.json())
                    .then(data => {
                        if (data.result && data.result.entity_state) {
                            document.getElementById('entity-state').textContent = data.result.entity_state;
                        }
                    });
                }, 5000);
            </script>
        </t>
    </template>

    <!-- Entity Group Portal Page -->
    <template id="portal_entity_group" name="Portal Entity Group View">
        <!-- Similar structure with entity list table -->
    </template>
</odoo>
```

### 檔案影響
- `views/portal_templates.xml` (新建)
- `__manifest__.py` (修改 data 列表)

### 設計考量
1. 使用 Bootstrap 4 元件（Odoo 標準）
2. 響應式設計 via Bootstrap grid
3. Polling JavaScript 內嵌，避免額外 asset bundle

## Dependencies

- [ ] Task 002: Controller 必須先完成（提供路由和資料）

## Effort Estimate

- Size: M
- Hours: 8
- Parallel: false (depends on 002)

## Definition of Done

- [ ] Code implemented
- [ ] Entity 頁面正確渲染
- [ ] Entity Group 頁面正確渲染（含列表）
- [ ] Chatter 可正常使用
- [ ] Mobile 裝置響應正確
- [ ] Code reviewed
