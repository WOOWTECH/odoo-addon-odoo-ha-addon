---
name: 清理測試與驗證
status: open
created: 2026-01-17T18:30:35Z
updated: 2026-01-17T18:38:39Z
github: https://github.com/WOOWTECH/odoo-addons/issues/57
depends_on: [55, 56]
parallel: false
conflicts_with: []
---

# Task: 清理測試與驗證

## Description

刪除 token 機制相關測試，執行驗證確保 Portal 頁面和 user-based sharing 功能正常。

## Acceptance Criteria

- [ ] 刪除 `tests/test_portal_mixin.py`
- [ ] Portal controller 測試通過
- [ ] User-based sharing 功能正常
- [ ] grep 掃描無 portal.mixin 和 action_share_portal 引用
- [ ] 模組可正常安裝

## Technical Details

### 刪除測試檔案

```bash
rm -f tests/test_portal_mixin.py
```

### 驗證指令

```bash
# 確認 portal.mixin 已移除
grep -rn "portal.mixin" models/ views/
# 預期：無輸出

# 確認 action_share_portal 已移除
grep -rn "action_share_portal" models/ views/
# 預期：無輸出

# 確認 action_share 保留
grep -rn "action_share" models/ views/
# 預期：顯示 action_share 方法和按鈕

# 執行 portal controller 測試
# docker compose exec web pytest tests/test_portal_controller.py -v

# 更新模組
# docker compose exec web odoo -d odoo -u odoo_ha_addon --dev xml
```

### 功能驗證

1. **Portal 頁面**：登入後存取 `/my/ha` 應正常顯示
2. **Entity 分享**：`action_share()` 按鈕應正常開啟 wizard
3. **Share 記錄**：`ha.entity.share` 記錄應正常建立

## Effort Estimate

- Size: S
- Hours: 0.25
- Parallel: false (依賴 #55, #56)

## Definition of Done

- [ ] test_portal_mixin.py 已刪除
- [ ] grep 掃描通過
- [ ] Portal controller 測試通過
- [ ] 模組在 Docker 環境正常安裝
- [ ] Portal 頁面可正常存取
