# Changelog - November 2025

## 2025-11-25: Removed `is_default` Field - Permission-Based Instance Selection

### What Changed

- Removed `is_default` Boolean field from `ha.instance` model
- Replaced 4-level fallback with 3-level permission-aware fallback
- All users now get their first accessible instance based on entity group authorization

### Why This Matters

| Aspect | Description |
|--------|-------------|
| **Security Fix** | Old design used `sudo()` to bypass permissions, allowing users to be assigned instances they couldn't access |
| **Simplified Logic** | Reduced from 4-level to 3-level fallback (Session -> User Pref -> First Accessible) |
| **User-Specific** | Each user now gets their own first accessible instance instead of a global default |

### New Instance Selection Logic

```
1. Session (request.session['current_ha_instance_id'])
2. User Preference (res.users.current_ha_instance_id)
3. First Accessible Instance (via get_accessible_instances(), filtered by ir.rule)
```

### Migration Notes

- No data migration needed - field removal is handled by Odoo upgrade
- Existing instances preserved with their sequence order
- Users will automatically get first accessible instance on next login

### Files Modified

14 files (9 backend, 2 views, 3 frontend, 1 migration deleted)
